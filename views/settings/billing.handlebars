<div class="row" style="padding-top: 25px">
	<div class="col-md-3" id="navMenuPanel">       
		{{> usernav billing=true}}
	</div>  
	<div class="col-md-9" id="browserArea">
		<h2>Billing</h2>
		<hr>
		<h5>Plan</h5>


		{{#if user.plan.name}}
		<a class="btn btn-danger" href="/users/{{user.username}}/cancel_subscription"><i class="fa fa-ban" aria-hidden="true"></i> Cancel Subscription</a>

		{{else}}
		<div class="well">
			<strong>Free plan</strong>, unlimited public repositories</strong>
		</div>
		<p><a class="btn btn-success" href="/users/{{user.username}}/settings/billing/upgrade">Get private repositories</a></p>
		{{/if}}		
		<hr>
		<h5>Payment</h5>
		{{#if braintree_customer}}
		<div class="btn-group" role="group" aria-label="...">
			<a class="btn btn-default" href="/users/{{user.username}}/settings/billing/payment"><i class="fa fa-credit-card" aria-hidden="true"></i> Edit payment method</a>
			<a type="button" class="btn btn-danger"    onclick="deleteBraintreeClient(this.id)" id="{{user._id}}"  data-toggle="modal" data-target="#myModal"><i class="fa fa-trash" aria-hidden="true"></i> Delete payment method</a>
		</div> 
		{{else}}
		<div class="well">
			<i class="fa fa-credit-card" aria-hidden="true"></i> No payment method on file.
		</div>			
		<p><a class="btn btn-default" href="/users/{{user.username}}/settings/billing/payment"><i class="fa fa-credit-card" aria-hidden="true"></i> Add payment method</a></p>
		{{/if}}
		<hr>
		<h5>Payment history</h5>
		<div id="transaction_history">
			<div class="well">
				You have not made any payments.	
			</div>			
		</div>
		<small>Amounts shown in USD</small>
	</div>
</div>

<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
	<div class="modal-dialog" role="document">
		<div class="modal-content"  id="modalTextArea">
		</div>
	</div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>

<script type="text/javascript">
/////////////////////////////////////
////        KICK MEMBER         //// 
///////////////////////////////////
function deleteBraintreeClient(ids){
	var html = '<div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button> <h4 class="modal-title" id="myModalLabel"><i class="fa fa-trash" aria-hidden="true"></i> Delete payment details.</h4> </div> <div class="modal-body"> <p>Are you sure you wish to delete these payment details from your account?</p> <div style="text-align: center"> <div id="modelHtml"></div> </div> </div> <div class="modal-footer"> <button type="button" class="btn btn-default" data-dismiss="modal">Close</button> </div>'
	$('#modalTextArea').html(html)
	$('#modelHtml').html('<a href="/users/deletepaymentdetails/'+ids+'" class="btn btn-danger">Delete these payment details.</a>')
}

var user = JSON.stringify('{{user.username}}')
//////////////////////////////////////////////////////
////        AJAX SUBMIT THE FORM - CREATE        //// 
////////////////////////////////////////////////////
function streamTransactions(){
	$.ajax({
		url: '/users/'+user+'/transaction_history',
		success: function(data) {
			data = JSON.parse(data)
			printTable(data)
		},
		error : function(err){
			console.log(err)
		}
	}); 
}

///////////////////////////////////
///// PRINT ACCOUNT HISTORY //////
/////////////////////////////////
function printTable(data){
	console.log(data)
	var html =''
	$('#transaction_history').html('')
	html += '<table class="table table-bordered" id="transaction_table" > <thead> <tr> <th>Date</th> <th>Id</th> <th>Status</th> <th>Currency</th> <th>Value</th> </tr> </thead> <tbody>'
	for (var i = 0; i < data.length; i++) {
		var date =  new Date(data[i].createdAt)
		date = moment(date).format('YYYY-MM-DD');
 
		html += '<tr><td>'+date+'</td><td>'+data[i].id+'</td><td>'+data[i].status+'</td><td>'+data[i].currencyIsoCode+'</td><td>'+data[i].amount+'</td></tr>'
	}
	html +='</tbody></table>  '
	$('#transaction_history').append(html)
	var table = jQuery('#transaction_table').DataTable({
		'destroy':true,
		"pagingType": "numbers"
  //  'order': [[ 2, 'asc' ]] ,
});
}

////////////////////////
///// INITIALIZE //////
//////////////////////
$(document).ready( function() {
	streamTransactions()
});



</script>